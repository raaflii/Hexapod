<!DOCTYPE html>
<html>
<head>
  <title>Hexapod Remote</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.7.3/nipplejs.min.js"></script>
  <style>
    body {
      margin: 0;
      background: #1e1e1e;
      display: flex;
      justify-content: space-around;
      align-items: center;
      height: 100vh;
      color: white;
      font-family: sans-serif;
    }
    #joystick-left, #joystick-right {
      width: 150px;
      height: 150px;
      background: #333;
      border-radius: 50%;
      position: relative;
    }
  </style>
</head>
<body>
  <div id="joystick-left"></div>
  <div id="joystick-right"></div>

  <script>
    const socket = new WebSocket('ws://' + '192.168.100.91' + '/ws');

    const sendJoystickData = () => {
      const data = {
        left: leftActive ? leftData : null,
        right: rightActive ? rightData : null
      };
    socket.send(JSON.stringify(data));
    };

    setInterval(sendJoystickData, 100);

    socket.onopen = () => {
      console.log('WebSocket connected to ESP32');
    };

    socket.onerror = (error) => {
      console.error('WebSocket Error:', error);
    };

    const left = nipplejs.create({
      zone: document.getElementById('joystick-left'),
      mode: 'static',
      position: { left: '50%', top: '50%' },
      color: 'red'
    });

    const right = nipplejs.create({
      zone: document.getElementById('joystick-right'),
      mode: 'static',
      position: { left: '50%', top: '50%' },
      color: 'blue'
    });

    left.on('move', (event, data) => {
      if (data) {
        const angle = data.angle.degree.toFixed(1);
        const force = data.force.toFixed(2);
        const msg = JSON.stringify({ joystick: 'left', angle, force });
        console.log('Left:', msg);
        socket.send(msg);
      }
    });

    right.on('move', (event, data) => {
      if (data) {
        const angle = data.angle.degree.toFixed(1);
        const force = data.force.toFixed(2);
        const msg = JSON.stringify({ joystick: 'right', angle, force });
        console.log('Right:', msg);
        socket.send(msg);
      }
    });
  </script>
</body>
</html>
